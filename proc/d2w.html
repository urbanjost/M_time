<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="Fortran date and time manipulation and presentation">
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>d2w &ndash; M_time</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">M_time </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../lists/files.html">Source Files</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
                   <li><a href="../lists/types.html">Derived Types</a></li>
            <li><a href="../lists/programs.html">Programs</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>d2w
      <small>Subroutine</small>
    </h1>
    <div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 1.3% of total for procedures.">35 statements</a>
     </li> 
    <li><i class="fa fa-code"></i><a href="../src/M_time.F90"> Source File</a></li>
  </ul>
  <ol class="breadcrumb in-well text-right">
     <li><a href='../sourcefile/m_time.f90.html'>M_time.F90</a></li>
     <li><a href='../module/m_time.html'>M_time</a></li>
     <li class="active">d2w</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    <div id="sidebar">
  <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/d2w.html#src">d2w</a>
  </div>
</div>

</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>public subroutine d2w(dat, iso_year, iso_week, iso_weekday, iso_name)</h2>
    

    <h2 id="name">NAME</h2>
<div class="codehilite"><pre><span></span><code>d2w(3f) - [M_time:WEEK_OF_YEAR] calculate iso-8601 Week-numbering
year date yyyy-Www-d given DAT date-time array
(LICENSE:PD)
</code></pre></div>

<h2 id="synopsis">SYNOPSIS</h2>
<div class="codehilite"><pre><span></span><code>subroutine d2w(dat,iso_year,iso_week,iso_weekday,iso_name)

 integer,intent(in)              :: dat(8)     ! input date array
 integer,intent(out)             :: iso_year, iso_week, iso_weekday
 character(len=10),intent(out)   :: iso_name
</code></pre></div>

<h2 id="description">DESCRIPTION</h2>
<p>Given a &ldquo;DAT&rdquo; array defining a date and time, return the ISO-8601
   Week in two formats &ndash; as three integer values defining the ISO year,
   week of year and weekday; and as a string of the form &ldquo;yyyy-Www-d&rdquo;.</p>
<h2 id="options">OPTIONS</h2>
<div class="codehilite"><pre><span></span><code>dat          &quot;DAT&quot; array (an integer array of the same format as
             the array returned by the intrinsic DATE_AND_TIME(3f))
             describing the date, which is the basic time description
             used by the other M_time(3fm) module procedures.
</code></pre></div>

<h2 id="returns">RETURNS</h2>
<div class="codehilite"><pre><span></span><code><span class="nv">iso_year</span>     <span class="nv">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="nv">year</span> <span class="nv">number</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">given</span> <span class="nv">date</span>
<span class="nv">iso_week</span>     <span class="nv">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="nv">week</span> <span class="nv">number</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">given</span> <span class="nv">date</span>
<span class="nv">iso_weekday</span>  <span class="nv">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="nv">weekday</span> <span class="nv">number</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">given</span> <span class="nv">date</span>
<span class="nv">iso_name</span>     <span class="nv">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="nv">Week</span> <span class="nv">string</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">data</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">form</span> <span class="s2">&quot;</span><span class="s">yyyy-Www-d</span><span class="s2">&quot;</span>.
</code></pre></div>

<h2 id="example">EXAMPLE</h2>
<div class="codehilite"><pre><span></span><code><span class="nv">Sample</span> <span class="nv">program</span>:

 <span class="nv">program</span> <span class="nv">demo_d2w</span>
 <span class="nv">use</span> <span class="nv">M_time</span>, <span class="nv">only</span> : <span class="nv">d2w</span>
 <span class="nv">implicit</span> <span class="nv">none</span>
 <span class="nv">integer</span>           :: <span class="nv">dat</span><span class="ss">(</span><span class="mi">8</span><span class="ss">)</span>     <span class="o">!</span> <span class="nv">input</span> <span class="nv">date</span> <span class="nv">array</span>
 <span class="nv">integer</span>           :: <span class="nv">iso_year</span>, <span class="nv">iso_week</span>, <span class="nv">iso_weekday</span>
 <span class="nv">character</span><span class="ss">(</span><span class="nv">len</span><span class="o">=</span><span class="mi">10</span><span class="ss">)</span> :: <span class="nv">iso_name</span>
    <span class="k">call</span> <span class="nl">date_and_time</span><span class="ss">(</span><span class="nv">values</span><span class="o">=</span><span class="nv">dat</span><span class="ss">)</span>
    <span class="k">call</span> <span class="nl">d2w</span><span class="ss">(</span><span class="nv">dat</span>,<span class="nv">iso_year</span>,<span class="nv">iso_week</span>,<span class="nv">iso_weekday</span>,<span class="nv">iso_name</span><span class="ss">)</span>
    <span class="nv">write</span><span class="ss">(</span><span class="o">*</span>,<span class="s1">&#39;</span><span class="s">(&quot;ISO-8601 Week:   &quot;,a)</span><span class="s1">&#39;</span><span class="ss">)</span><span class="nv">iso_name</span>
    <span class="nv">write</span><span class="ss">(</span><span class="o">*</span>,<span class="s1">&#39;</span><span class="s">(a,i0)</span><span class="s1">&#39;</span><span class="ss">)</span><span class="s1">&#39;</span><span class="s">ISO-8601 year    </span><span class="s1">&#39;</span>,<span class="nv">iso_year</span>
    <span class="nv">write</span><span class="ss">(</span><span class="o">*</span>,<span class="s1">&#39;</span><span class="s">(a,i0)</span><span class="s1">&#39;</span><span class="ss">)</span><span class="s1">&#39;</span><span class="s">ISO-8601 week    </span><span class="s1">&#39;</span>,<span class="nv">iso_week</span>
    <span class="nv">write</span><span class="ss">(</span><span class="o">*</span>,<span class="s1">&#39;</span><span class="s">(a,i0)</span><span class="s1">&#39;</span><span class="ss">)</span><span class="s1">&#39;</span><span class="s">ISO-8601 weekday </span><span class="s1">&#39;</span>,<span class="nv">iso_weekday</span>
 <span class="k">end</span> <span class="nv">program</span> <span class="nv">demo_d2w</span>

<span class="nv">results</span>:

 <span class="nv">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="nv">Week</span>:   <span class="mi">2016</span><span class="o">-</span><span class="nv">W29</span><span class="o">-</span><span class="mi">1</span>
 <span class="nv">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="nv">year</span>    <span class="mi">2016</span>
 <span class="nv">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="nv">week</span>    <span class="mi">29</span>
 <span class="nv">ISO</span><span class="o">-</span><span class="mi">8601</span> <span class="nv">weekday</span> <span class="mi">1</span>
</code></pre></div>

<h2 id="definition">DEFINITION</h2>
<p>The ISO-8601 date and time standard was issued by the International
   Organization for Standardization (ISO). It is used (mainly) in
   government and business for fiscal years, as well as in timekeeping.
   The system specifies a week year atop the Gregorian calendar by defining
   a notation for ordinal weeks of the year.</p>
<p>o An ISO week-numbering year (also called ISO year informally) has 52
     or 53 full weeks. That is 364 or 371 days instead of the usual 365
     or 366 days.
   o The extra week is referred to here as a leap week, although ISO-8601
     does not use this term.  Weeks start with Monday.
   o The first week of a year is the week that contains the first Thursday
     of the year (and, hence, always contains 4 January).  ISO week year
     numbering therefore slightly deviates from the Gregorian for some days
     close to January 1st.</p>
<h2 id="calculation">CALCULATION</h2>
<p>The ISO-8601 week number of any date can be calculated, given its
   ordinal date (i.e. position within the year) and its day of the week.</p>
<h2 id="method">METHOD</h2>
<div class="codehilite"><pre><span></span><code> <span class="nv">Using</span> <span class="nv">ISO</span> <span class="nv">weekday</span> <span class="nv">numbers</span> <span class="ss">(</span><span class="nv">running</span> <span class="nv">from</span> <span class="mi">1</span> <span class="k">for</span> <span class="nv">Monday</span> <span class="nv">to</span> <span class="mi">7</span> <span class="k">for</span> <span class="nv">Sunday</span><span class="ss">)</span>,
 <span class="nv">subtract</span> <span class="nv">the</span> <span class="nv">weekday</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">ordinal</span> <span class="nv">date</span>, <span class="k">then</span> <span class="nv">add</span> <span class="mi">10</span>. <span class="nv">Divide</span> <span class="nv">the</span>
 <span class="nb">result</span> <span class="nv">by</span> <span class="mi">7</span>. <span class="nv">Ignore</span> <span class="nv">the</span> <span class="nv">remainder</span><span class="c1">; the quotient equals the week</span>
 <span class="nv">number</span>. <span class="k">If</span> <span class="nv">the</span> <span class="nv">week</span> <span class="nv">number</span> <span class="nv">thus</span> <span class="nv">obtained</span> <span class="nv">equals</span> <span class="mi">0</span>, <span class="nv">it</span> <span class="nv">means</span> <span class="nv">that</span>
 <span class="nv">the</span> <span class="nv">given</span> <span class="nv">date</span> <span class="nv">belongs</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">preceding</span> <span class="ss">(</span><span class="nv">week</span><span class="o">-</span><span class="nv">based</span><span class="ss">)</span> <span class="nv">year</span>. <span class="k">If</span> <span class="nv">a</span>
 <span class="nv">week</span> <span class="nv">number</span> <span class="nv">of</span> <span class="mi">53</span> <span class="nv">is</span> <span class="nv">obtained</span>, <span class="nv">one</span> <span class="nv">must</span> <span class="nv">check</span> <span class="nv">that</span> <span class="nv">the</span> <span class="nv">date</span> <span class="nv">is</span> <span class="nv">not</span>
 <span class="nv">actually</span> <span class="nv">in</span> <span class="nv">week</span> <span class="mi">1</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">following</span> <span class="nv">year</span>.

 <span class="nv">These</span> <span class="nv">two</span> <span class="nv">statements</span> <span class="nv">are</span> <span class="nv">assumed</span> <span class="nv">true</span> <span class="nv">when</span> <span class="nv">correcting</span> <span class="nv">the</span> <span class="nv">dates</span>
 <span class="nv">around</span> <span class="nv">January</span> <span class="mi">1</span><span class="nv">st</span>:

 <span class="nv">o</span> <span class="nv">The</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">weeks</span> <span class="nv">in</span> <span class="nv">a</span> <span class="nv">given</span> <span class="nv">year</span> <span class="nv">is</span> <span class="nv">equal</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">corresponding</span>
   <span class="nv">week</span> <span class="nv">number</span> <span class="nv">of</span> <span class="mi">28</span> <span class="nv">December</span>.
 <span class="nv">o</span> <span class="nv">January</span> <span class="mi">4</span><span class="nv">th</span> <span class="nv">is</span> <span class="nv">always</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">first</span> <span class="nv">week</span>.
</code></pre></div>

<h2 id="iso_name">ISO_NAME</h2>
<p>Week date representations are in the format YYYYWww-D.</p>
<div class="codehilite"><pre><span></span><code><span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">[</span><span class="n">YYYY</span><span class="o">]</span><span class="w"> </span><span class="n">indicates</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ISO</span><span class="w"> </span><span class="n">week</span><span class="o">-</span><span class="n">numbering</span><span class="w"> </span><span class="nf">year</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">slightly</span><span class="w"></span>
<span class="w">   </span><span class="n">different</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">traditional</span><span class="w"> </span><span class="n">Gregorian</span><span class="w"> </span><span class="n">calendar</span><span class="w"> </span><span class="nf">year</span><span class="p">.</span><span class="w"></span>
<span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">[</span><span class="n">Www</span><span class="o">]</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">week</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">prefixed</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">letter</span><span class="w"> </span><span class="n">W</span><span class="p">,</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">W01</span><span class="w"></span>
<span class="w">   </span><span class="n">through</span><span class="w"> </span><span class="n">W53</span><span class="p">.</span><span class="w"></span>
<span class="w"> </span><span class="n">o</span><span class="w"> </span><span class="o">[</span><span class="n">D</span><span class="o">]</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">weekday</span><span class="w"> </span><span class="n">number</span><span class="p">,</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">beginning</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">Monday</span><span class="w"></span>
<span class="w">   </span><span class="ow">and</span><span class="w"> </span><span class="n">ending</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">Sunday</span><span class="p">.</span><span class="w"></span>
</code></pre></div>

<p>For example, the Gregorian date 31 December 2006 corresponds to the
   Sunday of the 52nd week of 2006, and is written</p>
<div class="codehilite"><pre><span></span><code> 2006-W52-7 (extended form)
 or
 2006W527 (compact form).
</code></pre></div>

<h2 id="reference">REFERENCE</h2>
<div class="codehilite"><pre><span></span><code>From Wikipedia, the free encyclopedia 2015-12-19
</code></pre></div>

<h2 id="author">AUTHOR</h2>
<div class="codehilite"><pre><span></span><code>John S. Urban, 2015-12-19
</code></pre></div>

<h2 id="license">LICENSE</h2>
<div class="codehilite"><pre><span></span><code>Public Domain
</code></pre></div>

    <h3>Arguments</h3>
      <table class="table table-striped varlist">
<thead><tr><th>Type</th><th>Intent</th><th>Optional</th><th>Attributes</th><th></th><th>Name</th><th></th></thead>
<tbody>
<tr>
  <td><span class="anchor" id="variable-dat~11"></span>integer,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>dat</strong>(8)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-iso_year"></span>integer,</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>iso_year</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-iso_week"></span>integer,</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>iso_week</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-iso_weekday"></span>integer,</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>iso_weekday</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-iso_name"></span>character(len=10),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>iso_name</strong></td><td></td>
</tr>
</tbody>
</table>

    <br>

    <section class="visible-xs visible-sm hidden-md">
      <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/d2w.html#src">d2w</a>
  </div>
</div>

    </section>
    <br class="visible-xs visible-sm hidden-md">


    
    

    
    


    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span><span class="k">subroutine </span><span class="n">d2w</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">iso_year</span><span class="p">,</span><span class="n">iso_week</span><span class="p">,</span><span class="n">iso_weekday</span><span class="p">,</span><span class="n">iso_name</span><span class="p">)</span><span class="w"></span>

<span class="c">! ident_18=&quot;@(#)M_time::d2w(3f): DAT date-time array to iso-8601 Week-numbering year date yyyy-Www-d&quot;</span>

<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">              </span><span class="kd">::</span><span class="w"> </span><span class="n">dat</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w">     </span><span class="c">! input date array</span>
<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">             </span><span class="kd">::</span><span class="w"> </span><span class="n">iso_year</span><span class="p">,</span><span class="w"> </span><span class="n">iso_week</span><span class="p">,</span><span class="w"> </span><span class="n">iso_weekday</span><span class="w"></span>
<span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">iso_name</span><span class="w"></span>
<span class="kt">integer</span><span class="w">                         </span><span class="kd">::</span><span class="w"> </span><span class="n">shared_weekday</span><span class="w"></span>
<span class="kt">integer</span><span class="w">                         </span><span class="kd">::</span><span class="w"> </span><span class="n">last_week_this_year</span><span class="w"></span>
<span class="kt">integer</span><span class="w">                         </span><span class="kd">::</span><span class="w"> </span><span class="n">dec28_lastyear</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w">   </span><span class="c">! December 28th is always in last week</span>
<span class="kt">integer</span><span class="w">                         </span><span class="kd">::</span><span class="w"> </span><span class="n">dec28_thisyear</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w">   </span><span class="c">! December 28th is always in last week</span>
<span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span><span class="w">                </span><span class="kd">::</span><span class="w"> </span><span class="n">day</span><span class="w"></span>
<span class="kt">integer</span><span class="w">                         </span><span class="kd">::</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<span class="w">   </span><span class="n">iso_year</span><span class="o">=</span><span class="n">dat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">                                               </span><span class="c">! initially assume the iso_year is the same as the data array year</span>
<span class="w">   </span><span class="n">iso_week</span><span class="o">=</span><span class="n">uncorrected_week_of_year</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span><span class="w">                        </span><span class="c">! this is the week number unless around January 1st</span>
<span class="w">   </span><span class="n">iso_weekday</span><span class="o">=</span><span class="n">shared_weekday</span><span class="w">                                    </span><span class="c">! this is the number of the day of the week assuming Monday=1</span>
<span class="w">   </span><span class="n">dec28_thisyear</span><span class="o">=</span><span class="p">[</span><span class="n">dat</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">12</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="n">dat</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="w">                  </span><span class="c">! Dec 28th is always in last week; use this to get number of weeks</span>
<span class="w">   </span><span class="n">last_week_this_year</span><span class="o">=</span><span class="n">uncorrected_week_of_year</span><span class="p">(</span><span class="n">dec28_thisyear</span><span class="p">)</span><span class="w">  </span><span class="c">! get the number of the last week of the year (52 or 53)</span>

<span class="w">   </span><span class="c">! correct dates around January 1st</span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">iso_week</span><span class="w">  </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="k">then</span><span class="w">                                         </span><span class="c">! if week &lt; 1 then week = lastWeek(year -1)</span>
<span class="w">      </span><span class="n">dec28_lastyear</span><span class="o">=</span><span class="p">[</span><span class="n">dat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="n">dat</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="w">             </span><span class="c">! Dec 28th is always in last week, we want its week number</span>
<span class="w">      </span><span class="n">iso_week</span><span class="o">=</span><span class="n">uncorrected_week_of_year</span><span class="p">(</span><span class="n">dec28_lastyear</span><span class="p">)</span><span class="w">          </span><span class="c">! got the week number for the last week of last year (52 or 53)</span>
<span class="w">      </span><span class="n">iso_year</span><span class="o">=</span><span class="n">dat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="w">                                          </span><span class="c">! our date belongs to last year</span>
<span class="w">   </span><span class="n">elseif</span><span class="p">(</span><span class="n">iso_week</span><span class="w"> </span><span class="o">&gt;</span><span class="n">last_week_this_year</span><span class="p">)</span><span class="k">then</span><span class="w">                     </span><span class="c">! if week &gt; lastweek(year) then week = 1</span>
<span class="w">      </span><span class="n">iso_week</span><span class="o">=</span><span class="n">iso_week</span><span class="o">-</span><span class="n">last_week_this_year</span><span class="w">                      </span><span class="c">! our date belongs to next year</span>
<span class="w">      </span><span class="n">iso_year</span><span class="o">=</span><span class="n">dat</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="w"></span>
<span class="w">   </span><span class="k">endif</span>

<span class="k">   write</span><span class="p">(</span><span class="n">iso_name</span><span class="p">,</span><span class="s1">&#39;(i4.4,&quot;-W&quot;,i2.2,&quot;-&quot;,i1)&#39;</span><span class="p">)</span><span class="n">iso_year</span><span class="p">,</span><span class="n">iso_week</span><span class="p">,</span><span class="n">iso_weekday</span><span class="w"> </span><span class="c">! create ISO string designation for our date</span>

<span class="k">contains</span>
<span class="k">   function </span><span class="n">uncorrected_week_of_year</span><span class="p">(</span><span class="n">datin</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="k">implicit none</span>
<span class="k">   </span><span class="kt">integer</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">uncorrected_week_of_year</span><span class="w"></span>
<span class="w">   </span><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">datin</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="kt">integer</span><span class="w">            </span><span class="kd">::</span><span class="w"> </span><span class="n">ordinal</span><span class="w"></span>
<span class="w">      </span><span class="k">call </span><span class="n">dow</span><span class="p">(</span><span class="n">datin</span><span class="p">,</span><span class="n">shared_weekday</span><span class="p">,</span><span class="n">day</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span><span class="w">                 </span><span class="c">! formula needs day of week 1..7 where Monday=1</span>
<span class="w">      </span><span class="n">ordinal</span><span class="o">=</span><span class="n">d2o</span><span class="p">(</span><span class="n">datin</span><span class="p">)</span><span class="w">                                      </span><span class="c">! formula needs ordinal day of year where Jan 1st=1</span>
<span class="w">      </span><span class="n">uncorrected_week_of_year</span><span class="o">=</span><span class="p">(</span><span class="n">ordinal</span><span class="o">-</span><span class="n">shared_weekday</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">7</span><span class="w"></span>
<span class="w">   </span><span class="k">end function </span><span class="n">uncorrected_week_of_year</span><span class="w"></span>

<span class="k">end subroutine </span><span class="n">d2w</span><span class="w"></span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>M_time was developed by John S. Urban<br>&copy; 2022 
</p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2022-08-03 21:24            </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>